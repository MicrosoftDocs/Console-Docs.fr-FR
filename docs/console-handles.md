---
title: Handles de console
description: Un processus de console utilise des handles pour accéder à la mémoire tampon d’entrée et à la mémoire tampon d’écran de sa console, notamment des fonctions GetStdHandle, CreateFile et CreateConsoleScreenBuffer.
author: miniksa
ms.author: miniksa
ms.topic: conceptual
keywords: console, applications en mode caractère, applications en ligne de commande, applications de terminal, API console
MS-HAID:
- '\_win32\_console\_handles'
- base.console\_handles
- consoles.console\_handles
MSHAttr:
- PreferredSiteName:MSDN
- PreferredLib:/library/windows/desktop
ms.assetid: dc723046-b3e9-418a-b386-79be411e5ac8
ms.localizationpriority: high
ms.openlocfilehash: acc7d65e15451fc2804dc1782644c1ccbaa30e28
ms.sourcegitcommit: 508e93bc83b4bca6ce678f88ab081d66b95d605c
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/04/2020
ms.locfileid: "96420238"
---
# <a name="console-handles"></a><span data-ttu-id="418a8-104">Handles de console</span><span class="sxs-lookup"><span data-stu-id="418a8-104">Console Handles</span></span>

<span data-ttu-id="418a8-105">Un processus de console utilise des handles pour accéder à la mémoire tampon d’entrée et à la mémoire tampon d’écran de sa console.</span><span class="sxs-lookup"><span data-stu-id="418a8-105">A console process uses handles to access the input and screen buffers of its console.</span></span> <span data-ttu-id="418a8-106">Un processus peut utiliser la fonction [**GetStdHandle**](getstdhandle.md), [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858) ou [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) pour ouvrir l’un de ces handles.</span><span class="sxs-lookup"><span data-stu-id="418a8-106">A process can use the [**GetStdHandle**](getstdhandle.md), [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858), or [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) function to open one of these handles.</span></span>

<span data-ttu-id="418a8-107">La fonction [**GetStdHandle**](getstdhandle.md) fournit un mécanisme permettant de récupérer les handles d’entrée standard (`STDIN`), de sortie standard (`STDOUT`) et d’erreur standard (`STDERR`) qui sont associés à un processus.</span><span class="sxs-lookup"><span data-stu-id="418a8-107">The [**GetStdHandle**](getstdhandle.md) function provides a mechanism for retrieving the standard input (`STDIN`), standard output (`STDOUT`), and standard error (`STDERR`) handles associated with a process.</span></span> <span data-ttu-id="418a8-108">Ces handles sont créés par le système pendant la création de la console.</span><span class="sxs-lookup"><span data-stu-id="418a8-108">During console creation, the system creates these handles.</span></span> <span data-ttu-id="418a8-109">À la base, `STDIN` est un handle vers la mémoire tampon d’entrée de la console, et `STDOUT` et `STDERR` sont des handles vers la mémoire tampon d’écran active de la console.</span><span class="sxs-lookup"><span data-stu-id="418a8-109">Initially, `STDIN` is a handle to the console's input buffer, and `STDOUT` and `STDERR` are handles of the console's active screen buffer.</span></span> <span data-ttu-id="418a8-110">Toutefois, la fonction [**SetStdHandle**](setstdhandle.md) peut rediriger les handles standard en modifiant le handle associé à `STDIN`, `STDOUT` ou `STDERR`.</span><span class="sxs-lookup"><span data-stu-id="418a8-110">However, the [**SetStdHandle**](setstdhandle.md) function can redirect the standard handles by changing the handle associated with `STDIN`, `STDOUT`, or `STDERR`.</span></span> <span data-ttu-id="418a8-111">Étant donné que les handles standard du parent sont hérités par tous les processus enfants, les appels suivants à **GetStdHandle** retourneront le handle redirigé.</span><span class="sxs-lookup"><span data-stu-id="418a8-111">Because the parent's standard handles are inherited by any child process, subsequent calls to **GetStdHandle** return the redirected handle.</span></span> <span data-ttu-id="418a8-112">Un handle retourné par **GetStdHandle** peut, par conséquent, référencer autre chose que les E/S de la console.</span><span class="sxs-lookup"><span data-stu-id="418a8-112">A handle returned by **GetStdHandle** may, therefore, refer to something other than console I/O.</span></span> <span data-ttu-id="418a8-113">Par exemple, avant de créer un processus enfant, un processus parent peut utiliser **SetStdHandle** pour définir un handle de canal comme étant le handle `STDIN` hérité par le processus enfant.</span><span class="sxs-lookup"><span data-stu-id="418a8-113">For example, before creating a child process, a parent process can use **SetStdHandle** to set a pipe handle to be the `STDIN` handle that is inherited by the child process.</span></span> <span data-ttu-id="418a8-114">Lorsque le processus enfant appelle **GetStdHandle**, il obtient le handle du canal.</span><span class="sxs-lookup"><span data-stu-id="418a8-114">When the child process calls **GetStdHandle**, it gets the pipe handle.</span></span> <span data-ttu-id="418a8-115">Cela signifie que le processus parent peut contrôler les handles standard du processus enfant.</span><span class="sxs-lookup"><span data-stu-id="418a8-115">This means that the parent process can control the standard handles of the child process.</span></span> <span data-ttu-id="418a8-116">Les handles retournés par **GetStdHandle** disposent d’un accès `GENERIC_READ | GENERIC_WRITE`, sauf si **SetStdHandle** a été utilisé dans le but de configurer un accès moindre pour le handle standard.</span><span class="sxs-lookup"><span data-stu-id="418a8-116">The handles returned by **GetStdHandle** have `GENERIC_READ | GENERIC_WRITE` access unless **SetStdHandle** has been used to set the standard handle to have lesser access.</span></span>

<span data-ttu-id="418a8-117">Les valeurs des handles retournées par [**GetStdHandle**](getstdhandle.md) ne sont pas 0, 1 et 2. Par conséquent, les constantes de flux prédéfinies standard contenues dans Stdio.h (`STDIN`, `STDOUT` et `STDERR`) ne peuvent pas être utilisées dans les fonctions qui nécessitent un handle de console.</span><span class="sxs-lookup"><span data-stu-id="418a8-117">The value of the handles returned by [**GetStdHandle**](getstdhandle.md) are not 0, 1, and 2, so the standard predefined stream constants in Stdio.h (`STDIN`, `STDOUT`, and `STDERR`) cannot be used in functions that require a console handle.</span></span>

<span data-ttu-id="418a8-118">La fonction [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858) permet à un processus d’obtenir un handle vers la mémoire tampon d’entrée et la mémoire tampon d’écran active de la console, même si `STDIN` et `STDOUT` ont été redirigés.</span><span class="sxs-lookup"><span data-stu-id="418a8-118">The [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858) function enables a process to get a handle to its console's input buffer and active screen buffer, even if `STDIN` and `STDOUT` have been redirected.</span></span> <span data-ttu-id="418a8-119">Pour ouvrir le handle vers la mémoire tampon d’entrée d’une console, spécifiez la valeur `CONIN$` dans un appel à **CreateFile**.</span><span class="sxs-lookup"><span data-stu-id="418a8-119">To open a handle to a console's input buffer, specify the `CONIN$` value in a call to **CreateFile**.</span></span> <span data-ttu-id="418a8-120">Spécifiez la valeur `CONOUT$` dans un appel à **CreateFile** pour ouvrir le handle vers la mémoire tampon d’écran active de la console.</span><span class="sxs-lookup"><span data-stu-id="418a8-120">Specify the `CONOUT$` value in a call to **CreateFile** to open a handle to a console's active screen buffer.</span></span> <span data-ttu-id="418a8-121">**CreateFile** vous permet de spécifier l’accès en lecture/écriture du handle qu’il retourne.</span><span class="sxs-lookup"><span data-stu-id="418a8-121">**CreateFile** enables you to specify the read/write access of the handle that it returns.</span></span>

<span data-ttu-id="418a8-122">La fonction [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) crée une mémoire tampon d’écran et retourne un handle.</span><span class="sxs-lookup"><span data-stu-id="418a8-122">The [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) function creates a new screen buffer and returns a handle.</span></span> <span data-ttu-id="418a8-123">Ce handle peut être utilisé dans toutes les fonctions qui acceptent un handle vers la sortie de la console.</span><span class="sxs-lookup"><span data-stu-id="418a8-123">This handle can be used in any function that accepts a handle to console output.</span></span> <span data-ttu-id="418a8-124">La nouvelle mémoire tampon d’écran n’est pas active (affichée) tant que son handle n’est pas spécifié dans un appel à la fonction [**SetConsoleActiveScreenBuffer**](setconsoleactivescreenbuffer.md).</span><span class="sxs-lookup"><span data-stu-id="418a8-124">The new screen buffer is not active (displayed) until its handle is specified in a call to the [**SetConsoleActiveScreenBuffer**](setconsoleactivescreenbuffer.md) function.</span></span> <span data-ttu-id="418a8-125">Notez que le fait de changer la mémoire tampon d’écran active n’affecte pas le handle retourné par [**GetStdHandle**](getstdhandle.md).</span><span class="sxs-lookup"><span data-stu-id="418a8-125">Note that changing the active screen buffer does not affect the handle returned by [**GetStdHandle**](getstdhandle.md).</span></span> <span data-ttu-id="418a8-126">De même, l’utilisation de [**SetStdHandle**](setstdhandle.md) pour modifier le handle `STDOUT` n’affecte pas la mémoire tampon d’écran active.</span><span class="sxs-lookup"><span data-stu-id="418a8-126">Similarly, using [**SetStdHandle**](setstdhandle.md) to change the `STDOUT` handle does not affect the active screen buffer.</span></span>

<span data-ttu-id="418a8-127">Les handles de console retournés par [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858) et [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) peuvent être utilisés dans toutes les fonctions de console qui nécessitent un handle vers la mémoire tampon d’entrée ou la mémoire tampon d’écran d’une console.</span><span class="sxs-lookup"><span data-stu-id="418a8-127">Console handles returned by [**CreateFile**](https://msdn.microsoft.com/library/windows/desktop/aa363858) and [**CreateConsoleScreenBuffer**](createconsolescreenbuffer.md) can be used in any of the console functions that require a handle to a console's input buffer or of a console screen buffer.</span></span> <span data-ttu-id="418a8-128">Les handles retournés par [**GetStdHandle**](getstdhandle.md) peuvent être utilisés par les fonctions de la console s’ils n’ont pas été redirigés pour référencer autre chose que les E/S de la console.</span><span class="sxs-lookup"><span data-stu-id="418a8-128">Handles returned by [**GetStdHandle**](getstdhandle.md) can be used by the console functions if they have not been redirected to refer to something other than console I/O.</span></span> <span data-ttu-id="418a8-129">Toutefois, si un handle standard a été redirigé pour référencer un fichier ou un canal, ce handle ne pourra être utilisé que par les fonctions [**ReadFile**](https://msdn.microsoft.com/library/windows/desktop/aa365467) et [**WriteFile**](https://msdn.microsoft.com/library/windows/desktop/aa365747).</span><span class="sxs-lookup"><span data-stu-id="418a8-129">If a standard handle has been redirected to refer to a file or a pipe, however, the handle can only be used by the [**ReadFile**](https://msdn.microsoft.com/library/windows/desktop/aa365467) and [**WriteFile**](https://msdn.microsoft.com/library/windows/desktop/aa365747) functions.</span></span> <span data-ttu-id="418a8-130">[**GetFileType**](https://docs.microsoft.com/windows/win32/api/fileapi/nf-fileapi-getfiletype) peut aider à déterminer le type d’appareil que le handle référence.</span><span class="sxs-lookup"><span data-stu-id="418a8-130">[**GetFileType**](https://docs.microsoft.com/windows/win32/api/fileapi/nf-fileapi-getfiletype) can assist in determining what device type the handle refers to.</span></span> <span data-ttu-id="418a8-131">Un handle de console se présente ainsi : `FILE_TYPE_CHAR`.</span><span class="sxs-lookup"><span data-stu-id="418a8-131">A console handle presents as `FILE_TYPE_CHAR`.</span></span>

<span data-ttu-id="418a8-132">Un processus peut utiliser la fonction [**DuplicateHandle**](https://msdn.microsoft.com/library/windows/desktop/ms724251) pour créer un handle de console dupliqué avec un accès ou un héritage différents de ceux du handle d’origine.</span><span class="sxs-lookup"><span data-stu-id="418a8-132">A process can use the [**DuplicateHandle**](https://msdn.microsoft.com/library/windows/desktop/ms724251) function to create a duplicate console handle that has different access or inheritability from the original handle.</span></span> <span data-ttu-id="418a8-133">Notez, toutefois, qu’un processus ne peut créer un handle de console dupliqué que pour sa propre utilisation.</span><span class="sxs-lookup"><span data-stu-id="418a8-133">Note, however, that a process can create a duplicate console handle only for its own use.</span></span> <span data-ttu-id="418a8-134">Cela diffère donc des autres types de handles (tels que les objets de fichier, de canal ou mutex), pour lesquels **DuplicateHandle** peut créer un doublon valide pour un processus différent.</span><span class="sxs-lookup"><span data-stu-id="418a8-134">This differs from other handle types (such as file, pipe, or mutex objects), for which **DuplicateHandle** can create a duplicate that is valid for a different process.</span></span>
<span data-ttu-id="418a8-135">L’accès à une console doit être partagé lors de la [création](creation-of-a-console.md) de l’autre processus, ou peut être demandé par l’autre processus par le biais du mécanisme [**AttachConsole**](attachconsole.md).</span><span class="sxs-lookup"><span data-stu-id="418a8-135">Access to a console must be shared during [creation](creation-of-a-console.md) of the other process or may be requested by the other process through the [**AttachConsole**](attachconsole.md) mechanism.</span></span>

<span data-ttu-id="418a8-136">Pour fermer un handle de console, un processus peut utiliser la fonction [**CloseHandle**](https://msdn.microsoft.com/library/windows/desktop/ms724211).</span><span class="sxs-lookup"><span data-stu-id="418a8-136">To close a console handle, a process can use the [**CloseHandle**](https://msdn.microsoft.com/library/windows/desktop/ms724211) function.</span></span>
